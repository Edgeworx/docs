{{ $currentSection := .CurrentSection }}
{{ $currentPage := . -}}
{{ $parentSection := relref . ".." }}

{{ $nextLink := "" }}
{{ $nextTitle := "" }}
{{ $nextArrow := "&larr;" }}

<div class="docs-navigation d-flex justify-content-between">
  <!--
    CAUTION: due to the funky way that hugo weights work, "Next"
    and "Previous" are opposite to what you'd expect!
    Yeah, I know, it's crazy. -->
  {{ if .NextInSection }}
    {{ $nextLink = .NextInSection.RelPermalink }}
    {{ $nextTitle = .NextInSection.Title }}
  {{ else if .IsSection }}
    {{/*
      We're on a Section page (_index.md), so we need to go up to the
      previous level to find the next item.
    */}}

    {{ $parent := .GetPage ".." }}
    {{ range $i, $item := $parent.Pages }}
      {{ if and (gt $i 0) (eq $item.RelPermalink $currentPage.RelPermalink) }}
        {{ $sib := index $parent.Pages (sub $i 1) }}
        {{ $nextLink = $sib.RelPermalink }}
        {{ $nextTitle = $sib.Title }}
        {{ $nextArrow = "&#8598;" }} {{/* The northwest arrow */}}
       {{ end }}
    {{ end }}


  {{ else }}
    <!-- This is the first non-section page (page 1) of the section -->
    {{ $nextLink = $currentSection.RelPermalink }}
    {{ $nextTitle = $currentSection.Title }}
  {{ end }}

  {{ with $nextLink }}
    <a href="{{ $nextLink }}">
      <div class="card my-1">
        <div class="card-body py-2">
          {{ $nextArrow | safeHTML}} {{ $nextTitle }}
        </div>
      </div>
    </a>
  {{ end -}}


  {{ $prevLink := "" }}
  {{ $prevTitle := "" }}

  {{ if .PrevInSection -}}
    {{ $prevLink = .PrevInSection.RelPermalink }}
    {{ $prevTitle = .PrevInSection.Title }}
  {{ end -}}

  {{ with $prevLink }}
    <a class="ms-auto" href="{{ $prevLink }}">
      <div class="card my-1">
        <div class="card-body py-2">
          {{ $prevTitle }} &rarr;
        </div>
      </div>
    </a>
  {{ end -}}

</div>
